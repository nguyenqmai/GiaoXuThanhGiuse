<ion-header>
    <ion-toolbar>
        <ion-title>
            Settings
            <ion-icon name="apps" (click)="showAdvanceOptions()"></ion-icon>
        </ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
        <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
            <ion-refresher-content></ion-refresher-content>
        </ion-refresher>

    <ion-list lines="full">
        <ion-item color="light">
            <ion-label slot="start" color="dark" class="ion-text-wrap">Notifications</ion-label>

            <ion-icon *ngIf="!hasNotificationAuthorizationInfo()"
                      slot="end" color="medium" name="log-in" (click)="login()"></ion-icon>
            <ion-icon *ngIf="hasNotificationAuthorizationInfo()"
                      slot="end" color="medium" name="log-out" (click)="logout()"></ion-icon>
            <ion-icon slot="end" color="medium" name="sync" (click)="refreshTopics()"></ion-icon>
        </ion-item>

        <ion-item-group *ngFor="let group of getTopicGroups()">
            <ion-item>
                <ion-icon slot="start" [name]="group.expanded ? 'arrow-dropdown' : 'arrow-dropright'"
                          (click)="tongleGroupExpansion(group)"></ion-icon>
                <ion-label color="medium" class="ion-text-wrap">{{group.englishName}}</ion-label>
                <ion-icon *ngIf="hasNotificationAuthorizationInfo()"
                          slot="end" color="medium" name="add" (click)="addTopic(group)"></ion-icon>
            </ion-item>

            <div *ngIf="group.expanded">
                <ion-item *ngFor="let item of group.subtopics">
                    <ion-label padding-start margin-start color="medium" class="ion-text-wrap">{{item.englishName}}</ion-label>
                    <ion-toggle *ngIf="!hasNotificationAuthorizationInfo() && !canSendNotification(item)"
                                margin-end slot="end" [color]="item.subscribed ? 'danger' : 'medium'"
                                [(ngModel)]="item.subscribed"
                                (ngModelChange)="checkboxItemClicked(item)"></ion-toggle>
                    <ion-icon *ngIf="canSendNotification(item)"
                              margin-end slot="end" [color]="medium"
                              name="chatbubbles" (click)="sendMessageToTopic(item)"></ion-icon>

                </ion-item>
            </div>
        </ion-item-group>

        <div *ngIf="refreshCount > 2">
            <ion-item>
                <ion-label slot="stacked" color="dark" class="ion-text-wrap">Backend Server</ion-label>
            </ion-item>
            <ion-item>
                <ion-label position="stacked">Server URL <ion-text color="danger">*</ion-text></ion-label>
                <ion-select [(ngModel)]="selectedBackEndUrl"
                            [selectedText]="selectedBackEndUrl"
                            (ionChange)="switchBackendServerUrl()"
                            placeholder="Select server URL"
                            multiple="false"
                            interface="action-sheet">
                    <ion-select-option *ngFor="let url of backendServerUrls" value="{{url}}">{{url}}</ion-select-option>

                </ion-select>
<!--                <ion-input-->
<!--                        type="url"-->
<!--                        inputmode="url"-->
<!--                        clearInput="true"-->
<!--                        [(ngModel)]="newBackendServerUrl"-->
<!--                        ></ion-input>-->
<!--                <ion-icon *ngIf="newBackendServerUrl != getBackendServerUrl()"-->
<!--                        slot="end"-->
<!--                        color="medium"-->
<!--                        name="checkbox-outline"-->
<!--                        (click)="switchBackendServerUrl()"></ion-icon>-->
            </ion-item>

<!--            <ion-item>-->
<!--                <ion-label slot="start" color="dark" class="ion-text-wrap">Login as operator</ion-label>-->
<!--            </ion-item>-->
<!--            <ion-item>-->
<!--                <ion-label position="stacked">Username</ion-label>-->
<!--                <ion-input-->
<!--                        type="text"-->
<!--                        inputmode="email"-->
<!--                        clearInput="false"-->
<!--                ></ion-input>-->
<!--            </ion-item>-->
<!--            <ion-item>-->
<!--                <ion-label position="stacked">Password</ion-label>-->
<!--                <ion-input-->
<!--                        type="password"-->
<!--                        inputmode="password"-->
<!--                        clearInput="true"-->
<!--                ></ion-input>-->
<!--            </ion-item>-->
<!--            <button ion-button  (click)="login()">Login</button>-->

            <ion-item>
                <ion-label slot="start" color="danger" class="ion-text-wrap">Clear local storage</ion-label>
                <ion-icon slot="end"
                          color="danger"
                          name="trash"
                          (click)="clearStorage()"></ion-icon>

            </ion-item>
        </div>

    </ion-list>

</ion-content>
